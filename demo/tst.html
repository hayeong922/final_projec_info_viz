<!DOCTYPE html>
<html lang="en">
<head>
    <title>Zika Explore</title>
    <meta charset="UTF-8">
    <link rel="stylesheet" type="text/css" href="./static/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="./static/css/dc.css"/>
    <script type="text/javascript" src="./static/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="./static/js/jquery-2.0.3.min.js"></script>
    <style>
      .heat-box {
        stroke: #E6E6E6;
        stroke-width: 2px;
      }
      .dc-data-count .total-count {
          color: #3182bd;
          font-weight: bold;
      }
      .dc-data-count .filter-count {
          color: #3182bd;
          font-weight: bold;
      }
    </style>

</head>

<header>
  
    <div class="navbar-header" style="margin-left:20px">
        <a class="navbar-brand" href="#">
          <h2>Zika Explore</h2>
      </a>
      <div class="container-fluid">
    <button type="button" href="javascript:dc.filterAll();dc.redrawAll();" class="btn btn-success reset" aria-label="Left Align" 
    style="margin-top:20px; margin-bottom:0px; margin-right:20px; height:44px">
      <span class="glyphicon glyphicon-star-empty" aria-hidden="true"></span> Reset
    </button>

  </div>
    </div>

</header>

<body>
<div class="container-fluid">

<div class="row" style="margin-top:150px; margin-left:10px">
      <div class='col-xs-6'>
        <div class="panel panel-success" >
          <div class="panel-heading">
            <h3 class="panel-title">sentiment</h3>
          </div>
          <div class="panel-body">
            <div id="test" style="height:550px"></div>
          </div>
        </div>

        <div class="panel panel-success" >
          <div class="panel-heading">
            <h3 class="panel-title">time series</h3>
          </div>
          <div class="panel-body">
            <div id="time_series" style="height:250px"></div>
          </div>
        </div>

      </div>

      <div class='col-xs-6'>
        <div class="panel panel-success" >
          <div class="panel-heading">
            <h3 class="panel-title">topic model</h3>
          </div>
          <div class="panel-body">
            <div id="row" style="height:300px"></div>
          </div>
        </div>
        <div class="panel panel-success" >
          <div class="panel-heading">
            <h3 class="panel-title">Tweets</h3>
          </div>
          <div class="panel-body">
            <div id="datatable" style="height:500px">
              <table class="table table-hover dc-data-table" id="data-table">
                <thead>
                    <tr class='header'>
  
                     </tr>
                </thead>
              </table>

            </div>
          </div>
        </div>
      </div>

</div>

<script type="text/javascript" src="./static/js/d3.js"></script>
<script type="text/javascript" src="./static/js/crossfilter.js"></script>
<script type="text/javascript" src="./static/js/dc.js"></script>
<script type="text/javascript">

var chartGroup = "chartGroup";
var chart = dc.heatMap("#test",chartGroup);
var RowChart = dc.rowChart("#row",chartGroup);
var datatable = dc.dataTable('#datatable',chartGroup);
var timeSeries = dc.lineChart("#time_series",chartGroup);

d3.csv("./data/tst.csv", function(error, experiments) {

  var timeFormat = d3.time.format("%a %b %d %H:%M:%S");

  experiments.forEach(function(d){
      d.times = timeFormat.parse(d.created_at.substr(0,18));
  });

  var ndx    = crossfilter(experiments),
      dim = ndx.dimension(function(d) {return d.topic;}),
      g = dim.group().reduceCount(function(d){return d.x;}),
      runDim = ndx.dimension(function(d) { return [+d.x, +d.y]; }),
      runGroup = runDim.group().reduceSum(function(d) { return +d.senti; }),
      dimHour = ndx.dimension(function(d){return d3.time.hour(d.times)}),
      hourGroup = dimHour.group().reduceCount(function(d){return d.times;});

  chart
    .width(19 * 31 + 80)
    .height(16 * 32 + 40)
    .dimension(runDim)
    .group(runGroup)
    .keyAccessor(function(d) { return +d.key[0]; })
    .valueAccessor(function(d) { return +d.key[1]; })
    .colorAccessor(function(d) { return +d.value; })
    .title(function(d) {
        return "x:   " + d.key[0] + "\n" +
               "y:  " + d.key[1] + "\n" +
               "sentiment : " + (d.value) ;})
    .colors(d3.scale.linear()
     .domain([0,1000])
     .range(['steelblue','red']))
    .calculateColorDomain();
  chart.xBorderRadius(0);
  chart.yBorderRadius(0);
  chart.render();

  RowChart.dimension(dim)
        .group(g)
        .height(300)
        .width(500);
  RowChart.render();

  datatable.dimension(runDim)
            .group(function(d) {
            return '   ';
          })
          .size(13)
          .columns([
            function(d) { return '*'+d.text; },
          ]);
  datatable.render();

  timeSeries.width(650)
    .height(250)
    .transitionDuration(500)
    .margins({top: 10, right: 10, bottom: 20, left: 40})
    .dimension(dimHour)
    .group(hourGroup)
    .elasticY(true)
    .x(d3.time.scale().domain(d3.extent(experiments, function(d) { return d.times; })))
    .xAxis();
  timeSeries.render();

});
</script>

</div>
</body>
</html>